<style>
    .img-avatar {
        width: 65px;
        height: 65px;
        object-fit: cover;
        object-position: center center;
        border-radius: 100%;
    }
</style>
<div class="card card-outline card-primary">
    <div class="card-header">
        <h3 class="card-title mt-2">List of Admin</h3>
        <div class="card-tools">
            <a href="" class="btn btn-primary" id="button-create-admin"><span class="fas fa-plus"></span>  Create New</a>
        </div>
    </div>
    <div class="card-body">
        <div class="container-fluid">
            <div class="container-fluid">
                <table class="table table-bordered table-stripped">
                    <colgroup>
                        <col width="10%">
                        <col width="20%">
                        <col width="30%">
                        <col width="25%">
                        <col width="8%">
                        <col width="5%">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal-create-admin" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title fs-5">Create Admin Account</h3>
                <button type="button" class="btn-close btn btn-default" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="form-create-admin-account">
                <div class="modal-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-4 form-group">
                                    <label for="modal-create-admin-account-username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="modal-create-admin-account-username" required>
                                    <div class="invalid-feedback">
                                        Username already exist!
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4 form-group">
                                    <label for="modal-create-admin-account-email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="modal-create-admin-account-email" required>
                                    <div class="invalid-feedback">
                                        Email already exist!
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-create-admin-account-firstname" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="modal-create-admin-account-firstname" required>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-create-admin-account-middlename" class="form-label">Middle Name</label>
                                    <input type="text" class="form-control" id="modal-create-admin-account-middlename" required>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-create-admin-account-lastname" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="modal-create-admin-account-lastname" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-4 form-group">
                                    <label for="modal-create-admin-account-password" class="form-label">Default Password</label>
                                    <input type="password" name="password" id="modal-create-admin-account-password" class="full-width form-control" placeholder="Enter Password" required autocomplete="new-password" onkeyup="checkPasswordStrength();" />
                                    <div id="password-strength-status"></div>
                                    <div class="invalid-feedback" id="helpertext-password">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-4 form-group">
                                    <label for="modal-create-admin-account-confirm-password" class="form-label">Confirm Default Password</label>
                                    <input type="password" class="form-control" id="modal-create-admin-account-confirm-password" required>
                                    <div class="invalid-feedback" id="helpertext-password">
                                        Default Password and Confirm Password doesn't matched!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Create <i class="fa fa-save"></i></button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="modal-update-admin" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title fs-5">Update Admin Account</h3>
                <button type="button" class="btn-close btn btn-default" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="" id="form-update-admin-account">
                <div class="modal-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-2">
                                <div class="mb-4 form-group">
                                    <label for="modal-update-admin-account-id" class="form-label">ID</label>
                                    <input type="text" class="form-control" id="modal-update-admin-account-id" readonly>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="mb-4 form-group">
                                    <label for="modal-update-admin-account-username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="modal-update-admin-account-username" required>
                                    <div class="invalid-feedback">
                                        Username already exist!
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="mb-4 form-group">
                                    <label for="modal-update-admin-account-email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="modal-update-admin-account-email" required>
                                    <div class="invalid-feedback">
                                        Email already exist!
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-update-admin-account-firstname" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="modal-update-admin-account-firstname" required>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-update-admin-account-middlename" class="form-label">Middle Name</label>
                                    <input type="text" class="form-control" id="modal-update-admin-account-middlename" required>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-update-admin-account-lastname" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="modal-update-admin-account-lastname" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-update-admin-account-status" class="form-label">Status</label>
                                    <select type="text" class="form-control" id="modal-update-admin-account-status" required>
                                        <option value="1">Active</option>
                                        <option value="0">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Update <i class="fa fa-save"></i></button>
                </div>
            </form>
        </div>
    </div>
</div>


<div class="modal fade" id="modal-view-admin" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title fs-5">View Admin Account</h3>
                <button type="button" class="btn-close btn btn-default" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="" id="form-view-admin-account">
                <div class="modal-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-2">
                                <div class="mb-4 form-group">
                                    <label for="modal-view-admin-account-id" class="form-label">ID</label>
                                    <input type="text" class="form-control" id="modal-view-admin-account-id" readonly>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="mb-4 form-group">
                                    <label for="modal-view-admin-account-username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="modal-view-admin-account-username" readonly>
                                    <div class="invalid-feedback">
                                        Username already exist!
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="mb-4 form-group">
                                    <label for="modal-view-admin-account-email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="modal-view-admin-account-email" readonly>
                                    <div class="invalid-feedback">
                                        Email already exist!
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-view-admin-account-firstname" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="modal-view-admin-account-firstname" readonly>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-view-admin-account-middlename" class="form-label">Middle Name</label>
                                    <input type="text" class="form-control" id="modal-view-admin-account-middlename" readonly>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="mb-4 form-group">
                                    <label for="modal-view-admin-account-lastname" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="modal-view-admin-account-lastname" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-bs-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>



<script>
    function checkPasswordStrength() {
        var number = /([0-9])/;
        var alphabets = /([a-zA-Z])/;
        var special_characters = /([~,!,@,#,$,%,^,&,*,-,_,+,=,?,>,<])/;
        var password = $("#modal-create-admin-account-password").val().trim();
        if (password.length < 6) {
            $('#password-strength-status').removeClass();
            $('#password-strength-status').addClass('weak-password');
            $('#password-strength-status').html("Weak (should be atleast 6 characters.)");
            $('#modal-create-admin-account-password').addClass('is-invalid');
            return false;
        } else {
            if (password.match(number) && password.match(alphabets) && password.match(special_characters)) {
                $('#password-strength-status').removeClass();
                $('#password-strength-status').addClass('strong-password');
                $('#password-strength-status').html("Strong");
                $('#modal-create-admin-account-password').removeClass('is-invalid');
                return true;
            } else {
                $('#password-strength-status').removeClass();
                $('#password-strength-status').addClass('medium-password');
                $('#password-strength-status').html("Medium (should include alphabets, numbers and special characters.)");
                $('#modal-create-admin-account-password').addClass('is-invalid');
                return false;
            }
        }
    }

    $(document).ready(function() {
        var ADMIN_LIST = "";
        retrieveAllUsers();

        function retrieveAllUsers() {
            $.ajax({
                url: adminRequest(GET_LOGIN_URL + "retrieve-user-list"),
                type: GET,
                cache: false,
                success: function(dataResult) {
                    var dataResult = JSON.parse(dataResult);
                    ADMIN_LIST = dataResult;
                    var adminRow = "";
                    if (dataResult.statusCode == 200) {
                        dataResult.userList.forEach(user => {
                            adminRow += `<tr>
                        <td>${user.id}</td>
                        <td>${user.firstName} ${user.middleName} ${user.lastName}</td>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>${formatStatus(user.status)}</td>
                        <td><button type="button" class="btn btn-flat btn-default btn-sm dropdown-toggle dropdown-icon" data-toggle="dropdown">
                                  Action
                            <span class="sr-only">Toggle Dropdown</span>
                          </button>
                          <div class="dropdown-menu" role="menu">
                            <a class="dropdown-item view_data " href="javascript:void(0)" data-id="${user.id}"><span class="fa fa-eye text-primary "></span> View</a>
                            <div class="dropdown-divider "></div>
                            <a class="dropdown-item edit_data " href="javascript:void(0)" data-id="${user.id}"><span class="fa fa-edit text-primary "></span> Edit</a>
                            <div class="dropdown-divider "></div>
                            <a class="dropdown-item delete_data " href="javascript:void(0)" data-id="${user.id}"><span class="fa fa-trash text-danger "></span> Delete</a>
                          </div>
                        </td>
                    </tr>`;
                        });
                    }
                    $('.table').DataTable().destroy();
                    $("#table-body").html(adminRow);
                    var table = $('.table').DataTable();
                    table.draw();
                    $("#table-body").html(adminRow);
                },
                beforeSend: function() {
                    console.log('Request is about to be sent.');
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // Code to be executed if the request fails
                    console.log('Request failed: ' + textStatus, errorThrown);
                },
                complete: function() {
                    // Code to be executed after the request completes, regardless of success or failure
                    console.log('Request completed.');
                }
            });
        }
        $("#button-create-admin").on("click", function(event) {
            event.preventDefault();
            $("#modal-create-admin").modal("show");
        });

        $(".table").on("click", ".view_data", function(event) {
            event.preventDefault();
            var id = $(this).data("id");
            ADMIN_LIST.userList.forEach(user => {
                if (id == user.id) {
                    $("#modal-view-admin-account-id").val(user.id);
                    $("#modal-view-admin-account-email").val(user.email);
                    $("#modal-view-admin-account-username").val(user.username);
                    $("#modal-view-admin-account-firstname").val(user.firstName);
                    $("#modal-view-admin-account-middlename").val(user.middleName);
                    $("#modal-view-admin-account-lastname").val(user.lastName);
                }
            });
            $("#modal-view-admin").modal("show");
        });

        $(".table").on("click", ".edit_data", function(event) {
            event.preventDefault();
            var id = $(this).data("id");

            ADMIN_LIST.userList.forEach(user => {
                if (id == user.id) {
                    $("#modal-update-admin-account-id").val(user.id);
                    $("#modal-update-admin-account-email").val(user.email);
                    $("#modal-update-admin-account-username").val(user.username);
                    $("#modal-update-admin-account-firstname").val(user.firstName);
                    $("#modal-update-admin-account-middlename").val(user.middleName);
                    $("#modal-update-admin-account-lastname").val(user.lastName);
                    $("#modal-update-admin-account-status").val(user.status);
                }
            });

            $("#modal-update-admin").modal("show");
        });

        $(".table").on("click", ".delete_data", function(event) {
            event.preventDefault();
            var id = $(this).data("id");
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: adminRequest(LOGIN_URL),
                        type: POST,
                        data: {
                            action: 'delete-admin-account',
                            id: id
                        },
                        cache: false,
                        success: function(dataResult) {
                            Swal.fire(
                                'Deleted!',
                                'Admin Account has been deleted.',
                                'success'
                            )
                            retrieveAllUsers();
                        },
                        beforeSend: function() {
                            console.log('Request is about to be sent.');
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            // Code to be executed if the request fails
                            console.log('Request failed: ' + textStatus, errorThrown);
                        },
                        complete: function() {
                            // Code to be executed after the request completes, regardless of success or failure
                            console.log('Request completed.');
                        }
                    });
                }
            })
        });

        $("#modal-create-admin-account-confirm-password").on("blur", function() {
            if ($("#modal-create-admin-account-password").val() != $("#modal-create-admin-account-confirm-password").val()) {
                $('#modal-create-admin-account-confirm-password').addClass('is-invalid');
            } else {
                $('#modal-create-admin-account-confirm-password').removeClass('is-invalid');
            }
        });

        $("#form-create-admin-account").on("submit", function(event) {
            event.preventDefault();
            var username = $("#modal-create-admin-account-username").val();
            var email = $("#modal-create-admin-account-email").val();
            var firstName = $("#modal-create-admin-account-firstname").val();
            var middleName = $("#modal-create-admin-account-middlename").val();
            var lastName = $("#modal-create-admin-account-lastname").val();

            var password = $("#modal-create-admin-account-password").val();
            var confirmPassword = $("#modal-create-admin-account-confirm-password").val();

            if (!checkPasswordStrength()) {
                return;
            }

            if (password != confirmPassword) {
                return;
            }

            $.ajax({
                url: adminRequest(LOGIN_URL),
                type: POST,
                data: {
                    action: "create-admin-account",
                    username: username,
                    email: email,
                    firstName: firstName,
                    middleName: middleName,
                    lastName: lastName,
                    password: password
                },
                cache: false,
                success: function(dataResult) {
                    var dataResult = JSON.parse(dataResult);
                    var optionValue = "";
                    if (dataResult.statusCode == 200) {
                        retrieveAllUsers();
                        Swal.fire({
                            icon: 'success',
                            title: 'Admin Account has been successfully created!',
                            showConfirmButton: false,
                            timer: 1500
                        })
                        $("#modal-create-admin").modal("hide");
                    }
                    if (dataResult.statusCode == 5001) {
                        $("#modal-create-admin-account-email").addClass("is-invalid");
                    } else {
                        $("#modal-create-admin-account-email").removeClass("is-invalid");
                    }

                    if (dataResult.statusCode == 5002) {
                        $("#modal-create-admin-account-username").addClass("is-invalid");
                    } else {
                        $("#modal-create-admin-account-username").removeClass("is-invalid");
                    }
                },
                beforeSend: function() {
                    console.log('Request is about to be sent.');
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // Code to be executed if the request fails
                    console.log('Request failed: ' + textStatus, errorThrown);
                },
                complete: function() {
                    // Code to be executed after the request completes, regardless of success or failure
                    console.log('Request completed.');
                }
            });


        });

        $("#form-update-admin-account").on("submit", function(event) {
            event.preventDefault();
            var id = $("#modal-update-admin-account-id").val();
            var username = $("#modal-update-admin-account-username").val();
            var email = $("#modal-update-admin-account-email").val();
            var firstName = $("#modal-update-admin-account-firstname").val();
            var middleName = $("#modal-update-admin-account-middlename").val();
            var lastName = $("#modal-update-admin-account-lastname").val();
            var status = $("#modal-update-admin-account-status").val();

            $.ajax({
                url: adminRequest(LOGIN_URL),
                type: POST,
                data: {
                    action: "update-admin-account",
                    id: id,
                    username: username,
                    email: email,
                    firstName: firstName,
                    middleName: middleName,
                    lastName: lastName,
                    status: status
                },
                cache: false,
                success: function(dataResult) {
                    var dataResult = JSON.parse(dataResult);
                    var optionValue = "";
                    if (dataResult.statusCode == 200) {
                        retrieveAllUsers();
                        Swal.fire({
                            icon: 'success',
                            title: 'Admin Account has been successfully updated!',
                            showConfirmButton: false,
                            timer: 1500
                        })
                        $("#modal-update-admin").modal("hide");
                    }
                    if (dataResult.statusCode == 5001) {
                        $("#modal-update-admin-account-email").addClass("is-invalid");
                    } else {
                        $("#modal-update-admin-account-email").removeClass("is-invalid");
                    }

                    if (dataResult.statusCode == 5002) {
                        $("#modal-update-admin-account-username").addClass("is-invalid");
                    } else {
                        $("#modal-update-admin-account-username").removeClass("is-invalid");
                    }
                },
                beforeSend: function() {
                    console.log('Request is about to be sent.');
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // Code to be executed if the request fails
                    console.log('Request failed: ' + textStatus, errorThrown);
                },
                complete: function() {
                    // Code to be executed after the request completes, regardless of success or failure
                    console.log('Request completed.');
                }
            });


        });

    });
</script>